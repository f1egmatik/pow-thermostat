# pow-thermostat
Heater/cooler controlling system with 2 devices: esp32 based Sonoff Pow Origin/Elite smart relay and Xiaomi Mijia temperature sensor

# Предыстория 
После установки в новой квартире симпатчного датчика температуры и влажности от Xiaomi появилась идея привязать его к какой-нибудь умной розетке на базе esp32, которая бы включала-выключала электрический обогреватель по мере необходимости. В имеющемся у меня конвекционном обогревателе есть аналоговый термостат, но он измеряет температуру непосредственно внутри нагревательного прибора, из-за чего конечная температура воздуха в один (тёплый) день может удерживаться на уровне 23 градуса, а в другой (холодный) на уровне 21 градус. Установка датчика температуры в другом конце помещения даст лучший контроль за уровнем комфортной температуры. 

Особый шарм задумке придаёт тот факт, что оба устройства выпускаются промышленно и находятся в корпусах от заводов-производителей и привлекательно выглядят, а не собираются на макетных платах. Причём для совместной работы этих двух устройств не потребуется промежуточный хаб или сервер, скажем, home assistant. Достаточно прошить esphome в умную розетку. 

# Розетки на базе esp32
Ринувшись на поиски умных розеток, я с разочарованием обнаружил, что все они делаются на базе дешёвой системы esp8266, у которой отсутствует bluetooth-модуль. Единственный производитель, который выпускает что-то на системе esp32 и похожее на розетки, это Sonoff. На конец 2022-го года у него была линейка из восьми устройств: 
POW/TH Origin/Elite 16/20. 

POW — реле с датчиками тока и напряжения и, соответственно, мощности, для них есть прошивки tasmota и esphome. 

TH — реле с внешним датчиком температуры и влажности (приобретается отдельно), для них свободных прошивок не видел. 

Origin — реле в простом прямоугольном корпусе с возможностью монтажа на din-рейку. 

Elite — к тому же корпусу приделан дисплей tm1621 (поддерживается в esphome). 

16 — реле на 16 А, управляется одним пином. 

20 — реле на 20 А, бистабильное, управляется двумя пинами, алгоритм управления имеется в esphome. 

Я не стал заморачиваться и для себя заказал самый простой и дешёвый вариант: POW Origin 16 (модель имеет идентификатор POWR316). Да, для подключения такого реле мне пришлось распороть удлинитель, из-за чего реализация выглядит уже не так симпатично как простая умная розетка. // Но и не так ужасно, как https://github.com/f1egmatik/aircontrol . 

# Заливка прошивки

# Контроль присутствия людей 


